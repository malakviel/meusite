name: Deploy

on:
  push:
    branches:
      - main # Substitua "main" pelo nome da sua branch

jobs:
  build:
    runs-on: ubuntu-latest # Escolha o sistema operacional para a execução do Action

    steps:
      - name: Checkout code
        uses: actions/checkout@v2 # Faz o checkout do código na branch definida

      - name: Install Firefox
        run:  |
          sudo snap remove firefoxsudo snap remove firefox
          sudo add-apt-repository ppa:mozillateam/ppa
          echo '
          Package: *
          Pin: release o=LP-PPA-mozillateam
          Pin-Priority: 1001
          ' | sudo tee /etc/apt/preferences.d/mozilla-firefox
          echo 'Unattended-Upgrade::Allowed-Origins:: "LP-PPA-mozillateam:${distro_codename}";' | sudo tee /etc/apt/apt.conf.d/51unattended-upgrades-firefox
          sudo apt-get install firefox -y

      - name: Copy file to root
        run: sudo cp linux_phat_client.tgz / # Copia o arquivo para a raiz do sistema

      - name: Extract file
        run: sudo tar zxvf linux_phat_client.tgz # Extrai o arquivo
        
      #- name: Change directory
      #  run: cd linux_phat_client # Entra na pasta extraída
      - name: Executar script de instalação
        run: |
          cd linux_phat_client
          sudo ./install_linux_phat_client.sh
        shell: bash
        
      - name: Conectar a VPN
        run: |
          echo "naclient login -profile DBB -user VPN_TI_DBB -password Ti@DBB2020"
          echo "y"
        shell: bash  
        
      - name: Teste de ping
        run: echo "naclient status"
