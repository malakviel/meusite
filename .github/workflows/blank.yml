name: Install FortiClient VPN Agent

on:
  push:
    branches:
      - main

jobs:
  install:
    runs-on: ubuntu-latest

    steps:
      - name: Download FortiClient VPN Agent
        run: |
          wget https://links.fortinet.com/forticlient/deb/vpnagent -O forticlient_vpn.deb
      - name: Install required dependencies
        run: |
           sudo apt-get update
           sudo apt-get install -y libappindicator1 libnss3-tools
      - name: Install FortiClient VPN Agent
        run: |
          sudo dpkg -i forticlient_vpn.deb
          
      - name: Config FortiClient VPN Agent
        run: |
          cd /opt/forticlient
          ./fortivpn edit VPNProfileName
          echo "177.124.242.118" | ./fortivpn add
          echo "10443" | ./fortivpn set sslvpn-port
          echo "1" | ./fortivpn set user-auth-type
          echo "<client certificate file path>" | ./fortivpn set client-cert-file
          echo "none" | ./fortivpn set client-cert-key-file
          echo "n" | ./fortivpn set invalid-cert-warning
          ./fortivpn connect VPNProfileName --user:marcelo.vasconcelos
